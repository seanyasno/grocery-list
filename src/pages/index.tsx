import { useState } from 'react';

import Head from 'next/head';

import { Footer, ResponsiveAppBar } from '@/components';
import { firestore } from '@/config';
import { FavoriteGroceriesProvider, ShoppingCartProvider } from '@/contexts';
import { GroceriesCategoriesList } from '@/features/groceries-categories';
import { GroceriesCardsList } from '@/features/grocery-item';
import { LiveBillCard } from '@/features/live-bill';
import { useUser } from '@/hooks';
import styles from '@/styles/Home.module.css';
import { theme } from '@/styles/theme';
import { Box, Grid } from '@mui/material';

const groceries = [
    { name: 'תפוח', price: 1.9, id: 'a' },
    { name: 'ענבים', price: 2.99, id: 'b' },
    { name: 'במבה פרו', price: 6, id: 'chp_temp_7290115203172' },
    { name: 'קוקה קולה', price: 3.0, id: 'c' },
    { name: 'מיץ תפוזים', price: 5.99, id: 'd' },
    { name: 'אוריאו', price: 9.99, id: 'e' },
    { name: 'עוף', price: 6.99, id: 'f' },
];

const HomePage = () => {
    const [layout, setLayout] = useState(1);
    const [user] = useUser('8YAcs0WvWQMCr0ki6F9QYXNDNvG3');

    return (
        <>
            <Head>
                <title>Create Next App</title>
                <meta
                    name="description"
                    content="Generated by create next app"
                />
                <meta
                    name="viewport"
                    content="width=device-width, initial-scale=1"
                />
                <link rel="icon" href="/favicon.ico" />
            </Head>

            <ShoppingCartProvider>
                <FavoriteGroceriesProvider
                    initialFavoriteGroceriesIds={user?.favoriteGroceries}
                    loadFromLocalStorage={false}
                >
                    <ResponsiveAppBar />

                    <main className={styles.main}>
                        <Box
                            sx={{
                                [theme.breakpoints.up('sm')]: {
                                    padding: '30px',
                                },
                            }}
                        >
                            <Grid container columnSpacing={3}>
                                <Grid
                                    item
                                    xs={layout === 1 ? 12 : true}
                                    height={layout === 1 ? '100%' : '80vh'}
                                    overflow={layout === 1 ? 'unset' : 'auto'}
                                >
                                    <Grid
                                        container
                                        spacing={3}
                                        display={'flex'}
                                    >
                                        <Grid
                                            item
                                            xs={layout === 1 ? true : 12}
                                            flexGrow={1}
                                            flex={1}
                                        >
                                            <Box
                                                sx={{
                                                    marginBottom: '40px',
                                                    width: '100%',
                                                    display: 'flex',
                                                }}
                                            >
                                                <GroceriesCategoriesList />
                                            </Box>
                                        </Grid>

                                        {layout === 1 && (
                                            <Grid
                                                item
                                                display={{
                                                    xs: 'none',
                                                    md: 'block',
                                                }}
                                            >
                                                <LiveBillCard
                                                    onExpandClick={() =>
                                                        setLayout((prev) =>
                                                            prev === 1 ? 2 : 1
                                                        )
                                                    }
                                                />
                                            </Grid>
                                        )}

                                        <Grid item>
                                            <GroceriesCardsList
                                                groceries={groceries}
                                                shrink={layout !== 1}
                                            />
                                        </Grid>
                                    </Grid>
                                </Grid>

                                {layout !== 1 && (
                                    <Grid
                                        item
                                        display={{ xs: 'none', md: 'block' }}
                                    >
                                        <LiveBillCard
                                            expanded={layout !== 1}
                                            onExpandClick={() =>
                                                setLayout((prev) =>
                                                    prev === 1 ? 2 : 1
                                                )
                                            }
                                        />
                                    </Grid>
                                )}
                            </Grid>
                        </Box>
                    </main>
                </FavoriteGroceriesProvider>
            </ShoppingCartProvider>

            <Footer />
        </>
    );
};

export default HomePage;
